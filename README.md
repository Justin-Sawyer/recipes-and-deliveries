<h1 align="center"><a style="color:green" href="">Recipes and Deliveries</a></h1>

<img src="documentation/image-aid/screenshot.png">

This is the website and application for **Recipes***and***Deliveries**, a community driven website and app offering the ability to purchase meal kits, contribute to the repository of recipes available for purchasing as well as to its blog.

While the website is free to use and peruse, certain parts of the site are reserved for account holders. These include:

1. Creating and editing recipes and blog posts
2. Ingredient listings and recipe preparation in user created posts
3. The ability to up-vote (or like) user created recipes

Although community based, the purpose of the website is commercial, thus readers are urged to sign up and order meal kits in order to access all parts of the website.

As an encouragement for users to do so, the user has the possibility of having his or her submitted recipes being added to the database of recipes and earning a discount once their recipe is added as a Recipe Box.

# User Experience (UX)
## User stories
### First Time Visitors

1) As a first time visitor, I want at first glance to understand the principle of the site:

	- I want to know that the recipes listed as products are meal kits and that all ingredients are included when I order a kit. Upon receipt of the kit, all I then need to do is follow the cooking instructions.

	- I want to understand about the delivery service and especially about how cold chain and hygiene rules are respected.

	- I want to be made aware about the benefits of using the service, such as the reduction of food waste and any economies I might make through the use of the service.

	- I want to be reassured that wherever possible, local ingredients and suppliers are used, and that all fresh ingredients are traceable.

	- I want the possibility to sign up to the service to access all the features of the website, whether I decide to purchase a recipe kit or not.

2) Upon ordering a recipe kit, I either:

	- Want the possibility of being an "anonymous" user. That is, should I so wish, I want to be able to order a recipe kit without having to create an account.

	- Want to become a registered user, with my details saved for both making future purchases and for contributing to the growing list of community recipes and blog posts.

### Returning Registered Visitors

1) As a returniing registered visitor, I would like to alert the community of the quality of the recipe box(es) I ordered:

	- I would like to be able to leave comments on the recipe details page.

2) As a registered user, I would like the possibility to:

	- Comment on blog posts created by other community members.

	- Up-vote community-created recipes that I find particluarly mouth-watering in the hope that these recipes be added to the recipe database.

	- Create and edit my own recipe concoctions and have them voted on by other community members.

	- Delete blog posts and recipes should I need to.

3) Upon making further orders, I wish that the following information be retrieved automatically, so that I do not have to go through the tedium of re-enetering the details:

	- Delivery address

	- Invoice address

	- Email & telephone details

4) I wish to be able to edit the above details both when I make a purchase and from within my Account page

### Returning "Anonymous" Visitors

1) As a returning anonymous user, I understand that remaining anonymous means just that. However:

	- If I have previously made a purchase, my invoice address and delivery address has been retained for the purpose of invoicing and delivery. I understand that this information is stored by necessity only.

	- Upon returning to the app, I understand that I will be prompted to create an account in order to access all the features of the website, and contribute to the community should I decide to.

### Frequent Registered Visitors

1) As a frequent registered visitor, I will be a participating member of the **Recipes***and***Deliveries** community:

	- I will have made regular orders of Recipe Boxes, and am likely to have created either recipes or blog entries.

	- If I have created recipes and my recipes have been voted as being the most popular of the last month, I will be alerted that this is the case, and I will see my recipe featured on the recipe boxes purchasing page.

2) As a frequent registered visitor whose recipes have received a certain number of votes and thus qualify to be added as Recipe Boxes:

	- I understand that I, myself, have nothing to do except collect the reward (see next point). I understand that **Recipes***and***Deliveries** look after the dispatching of recipe boxes, and that all I have done is create the recipe itself.

	- I understand that when the recipe I created is added as a Recipe Box, I will be given a credit that is redeemable against a future order I make on the **Recipes***and***Deliveries** website.

	- I can see a tally of the total votes for my recipe on my User Account page. When any recipes I create reach the required number of votes, I will be alerted by email of this fact, and thus will know I have a discount to claim.

### Frequent Anonymous Visitors

1) I have a good understanding of the functionality of the site, but have chosen for whatever reason to remain anonymous:

	- I accept that doing so means that some part of the site will remain inacessible to me until I decide to register.

	- If I do decide to register, I get full access to the site, but am not obligated to contribute

## Professionals and Aspiring Chefs

**Recipes***and***Deliveries** has the possibility of centralising the multitute of recipe websites that can be found online.

Just as regular users can earn a credit when other users vote for one of their recipes, **Recipes***and***Deliveries** could be a place that hghlights up and coming talents. Once a professional, accredited chef signs on to the service, **Recipes***and***Deliveries** could be a place where said chef might make an income. For the professional, in other words, there could be a small monetary reward instead of a credit whenever a user orders a professional's recipes. 

## Design
### Overall Colour Scheme
		
The project uses a simple design, with colours that are designed to make the end user either think of food or are intuitive in what their purpose is. 

Thus, green is the natural choice for its primary colour. Green is the colour of both most vegetables and most herbs, and is universally known as "Go". Thus the user knows that generally speaking, clicking something green will take the user there. Equally, if the user is registered and wants to contribute to the community, this green signifies "create".

The green is contrasted with brown, which makes the end user think of the warmth of spice and spice mixtures. The brown chosen - the colour of cinnamon - is almost amber, which makes the user think of preparing, just as the amber light in traffic signals tells the driver to prepare to go. Thus, where this cinnamon colour is used, the user knows to either prepare to edit a recipe or the user's Account details.

Where red is used, the user knows this as a "stop", just as the red in traffic signals does. Thus, when red is used in the "store", it means "cancel". Equally, on the community side of the site, red can stand for either deleting something, or anything with a "negative" connotation to it, such as removing a recipe from the user's list of favourite recipes. The exception for this is of course where the recipes are in the list of favourites - the natural colour for a badge containing a heart is of course red.

### Typography
		
Taste is of course a very evocative sense. For this reason, the typography of this website is very important. Just as it is almost always possible to tell the quality of a restaurant from looking at the styling of its menu, this is also the case for the **Recipes***and***Deliveries** website.

It is for this reason that the [Great Vibes](https://fonts.google.com/specimen/Great+Vibes) font has been chosen for headlines and slogans. The font is at once clean and flowing while also being elegant - just as a visit to a classy restaurant should be.

Otherwise, for general text and banners, [Raleway](https://fonts.google.com/specimen/Raleway?query=raleway) has been chosen. A simple sans-serif, it has been chosen for both its clarity and for the nuance behind its name: Raleway resembles the font styles used in transport hubs such as railway stations. Going to the station implies taking a journey, and people often talk of going on a "culinary adventure" - a journey in its own right. Raleway, then, is the perfect base font for **Recipes***and***Deliveries**.

### Imagery
#### Recipe Box Photos
		
Imagery is extremely important on any website, but especially so on commercial, food oriented ones: Nothing makes the tongue water more than seeing a beautifully presented meal. The images inspire the end user to both try the recipe, and more importantly, join the community and become an active member.

The "all recipe boxes" page is a showcase for all the recipe boxes that are available for order, and each is represented by an image and star rating (see Testing, below).

Ideally, each individual recipe box page should have the final end meal for that recipe as its banner image. However, this is a community website, where users are encouraged to participate by adding their own recipes to that section of the site and eventaully to the repository. 

Thus, when uploading a recipe to the website, the community member is prompted to add an image of the prepared meal. 

For plaigirism reasons, the user is only given the option of uploading images from their device, rather than having the option to search online for images. The user is also asked to provide an image credit.

However, it is fair to say that not everyone knows how to take a good photo, just as not everyone knows how to cook. 

It is for this reason that images on the Recipe Box pages might have been either professionally sourced, or created by the site owners themselves. It is for this reason that images are credited.

#### Backgrounds

Again, to reinforce the desire for food - and thus purchasing a recips box -  an image of fresh produce has been used as the background rather than a plain white one. Care has been taken to ensure that banner or headline text is not rendered ilisible by the background image. All "generic" screen sizes have been tested (ie, xs (mobile), sm (tablet portrait), md (tablet landscape, lg (desktop) and xl) but there may be certain "in-between" screen resolutions where this text may be obscured by the background image.

#### Recipe Box Cards

Recipe boxes are presented as cards with white backgrounds. Thus each recipe box available for order is subtly highlighted against the screen background. White has been chosen to once again reinforce the idea of "fresh, clean and hygienic".

## Wireframes

[Landing Page, highlighting the commercial service](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/1-recipes.png)

[Landing Page, highlighting the community aspect](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/2-deliveries.png)

[Commerce, all Recipe Boxes](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/3-all-recipe-boxes.png)

[Commerce, individual Recipe Box](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/4-recipe-box.png)

[Commerce, shopping bag](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/5-bag.png)

[Commerce, checkout](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/6-checkout.png)

[Community, blog](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/7-community-blog.png)

[Community, individual blog entry](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/8-community-blog-entry.png)

[Community, add edit or delete blog post](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/9-community-blog-add-edit-delete-post.png)

[Community, recipes](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/10-community-recipes.png)

[Community, individual recipe entry](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/11-community-recipe-entry.png)

[Community, add edit or delete recipe post](https://github.com/Justin-Sawyer/recipes_and_deliveries/blob/master/documentation/wireframes/12-community-recipes-add-edit-delete-recipe.png)

## Features

This website is fully responsive and interactive.

## Technologies Used
### Languages
	
[HTML5](https://en.wikipedia.org/wiki/HTML5)

[CSS](https://en.wikipedia.org/wiki/CSS)

[JavaScript](https://en.wikipedia.org/wiki/JavaScript)

[jQuery](https://en.wikipedia.org/wiki/JQuery)

[JSON](https://en.wikipedia.org/wiki/JSON)

[Python](https://en.wikipedia.org/wiki/Python_(programming_language))

### Frameworks, Libraries & Programs

[Markdown Editor](https://iwaki.info/markdown-editor-mac/en/index.html) was used for the writing of this README.md file.

[Balsamiq](https://balsamiq.com) was used for the creation of the wireframes.

[Git](https://git-scm.com) was used for version control.

[GitPod](https://www.gitpod.io/) was used as the writing tool. 

[GitHub](https://www.gitpod.io/) was used as the repository for the files within this project.

[Heroku](https://www.heroku.com/home) was used for hosting this project.

[Amazon Web Services](https://aws.amazon.com/) was used for the hosting of static files.

[Preview for Mac](https://support.apple.com/en-gb/guide/preview/welcome/mac) was used for image sizing (height and width), where images are the author's own or were posted by the author.

[Squash](https://www.realmacsoftware.com/squash/) was used to lighten the weight of image files, where images are the author's own or were posted by the author.

[Bootstrap](https://getbootstrap.com/) forms the vast majority of the formatting code, such as the grid system, containers, buttons, icons etc. It has been heavily modified by the author of this project to suit the website's needs.

[Font Awesome v4.7.0](https://fontawesome.com/v4.7.0/) was used for the social icons used on this site, since they are so easily recognisable.

[Google Fonts](https://fonts.google.com/) was used for the typography.

[Django](https://www.djangoproject.com/) is the framework upon which this website is built.

[django-allauth](https://django-allauth.readthedocs.io/en/latest/index.html) was used for user authentication.

[Stripe](https://stripe.com/en-gb) was used for the payment system.

[Pexels](https://www.pexels.com/) was used to source the Recipe Box card images, unless otherwise stated.

## Testing
### Code Validation

This website was tested using the following tools:

1. [W3C HTML](https://validator.w3.org/) was used to verify the HTML code:
	* [Results](https://github.com/Justin-Sawyer/recipes_and_deliveries/tree/master/documentation/screenshots/html)

2. [W3C CSS](https://jigsaw.w3.org/css-validator/) was used to ensure there were no CSS code errors in this project:
	* [Results](https://github.com/Justin-Sawyer/recipes_and_deliveries/tree/master/documentation/screenshots/css)

3. [JSHint](https://jshint.com/) was used for the verification of the JavaScript:
	* [Results](https://github.com/Justin-Sawyer/recipes_and_deliveries/tree/master/documentation/screenshots/js)

4. [Python Validator](http://pep8online.com/) was used for verification of all Python code:
	* [Results (.txt files)](https://github.com/Justin-Sawyer/recipes_and_deliveries/tree/master/documentation/screenshots/python)

5. Google Chrome's Dev Tool was used extensively while writing this website.

6. The [Lighthouse plugin for Google Chrome](https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk?hl) was used for speed checking and "tweaking" settings for maximal optimisation for web deployment.
	* [Results (.pdf files)](https://github.com/Justin-Sawyer/recipes_and_deliveries/tree/master/documentation/screenshots/lighthouse)

### Testing User Stories


### Testing Functionality

This project has been a labour of love and has taken many, many hours to complete. Code was tested exhaustively to check for errors and bugs:


#### Star Ratings

The developer wrote a little JavaScript script to display star icons according to the Recipe Box rating. Thus, if a Recipe Box had a rating of 3/5, three amber stars would be displayed.

The developer first wrote this script for individual Recipe Boxes. Thus, when a user clicks an individual Recipe Box in the All Recipe Boxes page, the user is taken to the page for that Recipe Box. Here, the user is presented with the Recipe Box name, its price, the categories to which it belongs, and its star rating (plus its rating value out of 5):

<img src="documentation/screenshots/testing/star-rating-individual-box.png">

The script:

```
let rate = document.getElementById('rating').innerText;
let icon = document.getElementById('rating').innerHTML;

let rateStr = rate.split('.')[0];
let rateInt = parseInt(rateStr);
let iconStr = icon.split(rate)[0];
for (let i=0; i<rateInt; i++) {
	newRating = document.querySelector('#rating').innerHTML += iconStr;
}

let stars = newRating.split('5')[1];
$('#rating').html(`${stars} ${rate}`);
```

where `#rating` is 

```
<small class="text-muted" id="rating">
    <i class='text-amber fas fa-star mr-1'></i>
    {{ product.rating }} / 5
</small>
```

As can be seen, although the above code works, it is not very "succinct". The first two lines of the code are essentially calling different parts of the same code string. 

Further, the loop is adding to the existing code, essentially duplicating code needlesly. Thus, if the `rateInt` value is 3, the code in the HTML becomes 

```
<i class='text-amber fas fa-star mr-1'></i>
{{ product.rating }} / 5
<i class='text-amber fas fa-star mr-1'></i>
<i class='text-amber fas fa-star mr-1'></i>
<i class='text-amber fas fa-star mr-1'></i>
```

To counter this, a new variable `stars` is created to take the split value of the above string from the `5` onwards (ie, the three trailing icons).

Then, in the last line of the script, the existing HTML string is removed entirely and replaced with `stars` (the three trailing icons) and `rate`(the rating out of 5).

At this point, the developer was not concerned with the elegance of the script, seeking just a proof of concept which he could use for the All Recipe Boxes page.

The developer knew that he would have to adapt this code to classes rather than ids, firstly because the HTML would show an error if each element had an id of `rating` and secondly because if each element being questioned had the same id value, then any code written to get the Integer value of the rating would only return the last of those values.

Thus the developer adapted the HTML to include a class `rating` and for each of the elements in that class to have an id of `rating_{{ product.id }}`:

```
<p class="text-muted rating" id="rating_{{ product.id }}">
    <small>
        <i class='text-amber fas fa-star mr-1'></i>
        {{ product.rating }} / 5
    </small>
</p>
```

From here, the developer was able to extract each `{{ product.rating }}` and split them to their Integer values as array entries, and each id value and create an array from these id values:

```
// Create array of Integer values of {{ product.rating }}
let ratings = $('.rating').map(function(){
        return $(this).text().split('.')[0];
    }).get().map(Number);
// (ex: ratings = [4, 4, 5, 3, 4, 4])

// create array of .rating individual ids
let rating = $('.rating').map(function(){
        return $(this).attr('id');
    }).get()
// (ex: rating = ['rating_1', 'rating_2', 'rating_3', 'rating_4', 'rating_5', 'rating_6']
```

The problem the developer was now confronted with was the dynamic nature of these values. The developer knew he could write a line of code for each id, however as the site grows the developer would need to keep adding code for each recipe box element added to the site. 

The developer turned towards his Python code, to see whether he could dynamically retrieve each Integer rating value from within the all_products function.

```
def all_products(request):
    """ A view to show all products, including sorting and search queries """

    products = Product.objects.all().order_by('-pk')
    query = None
    categories = None
    sort = None
    direction = None
    if request.GET:
        if 'sort' in request.GET:
            sortkey = request.GET['sort']
            sort = sortkey
            if sortkey == 'name':
                sortkey = 'lower_name'
                products = products.annotate(lower_name=Lower('name'))
            if sortkey == 'category':
                sortkey = 'category__name'

            if 'direction' in request.GET:
                direction = request.GET['direction']
                if direction == 'desc':
                    sortkey = f'-{sortkey}'
            products = products.order_by(sortkey)

        if 'category' in request.GET:
            categories = request.GET['category'].split(',')
            products = products.filter(category__name__in=categories)
            categories = Category.objects.filter(name__in=categories)

        if 'q' in request.GET:
            query = request.GET['q']
            if not query:
                messages.error(request,
                               "You didn't enter any search criteria!")
                return redirect(reverse('products'))

            queries = Q(name__icontains=query) | Q(
                description__icontains=query)
            products = products.filter(queries)

    current_sorting = f'{sort}_{direction}'

    context = {
        'products': products,
        'search_term': query,
        'current_categories': categories,
        'current_sorting': current_sorting,
    }

    return render(request, 'products/products.html', context)
```

The developer wondered whether adding 

```
'product': product,
'ratings': range(int(ratings)),
```

to the `context`, getting the rating values from the Product model

`ratings = products.filter(rating='rating')`

 and using template logic in the HTML

```
{% for r in rating %}
	<i class='text-amber fas fa-star mr-1'></i>
{% endfor %}
```

might be the answer. 

The developer tried many variations of this code, but with each try was always confronted with templating errors.

The developer turned back to the JavaScript. Still the problem was the same: How to get dynamically generated id values and use those values to insert code?

Firstly, the developer knew that he would have to include the `{{ product.rating }}` within the HTML itself. Otherwise the JavaScript would have no value to get.

He knew also that he would have to loop through each rating value, if a product had a rating. Thus, he adapted the HTML code as follows:

```
{% if product.rating %}
    <p class="text-muted rating" id="rating_{{ product.id }}">
        <small>
            {% for r in rating %}
                <!-- Star Rating here -->
            {% endfor %}
            {{ product.rating }} / 5
        </small>
    </p>
{% else %}
    <small class="text-muted">No Rating</small>
{% endif %}
```

After much research and trial and error, the developer eventually found a way in the JavaScript to loop through the rating class, assign each individual id's text value of that class to a variable, then override the HTML to display the number of stars according to the Integer value of each item's rating plus its rating value out of 5:

```
let rating = $('.rating').map(function(){
    return $(this).attr('id');
}).get();
// (ex: rating = ['rating_1', 'rating_2', 'rating_3', 'rating_4', 'rating_5', 'rating_6']

for (r of rating) {
    // For each array entry, get its Full Number rating value
    let ratingValueForIcon = $(`#${r}`).text().split('.')[0];
    // For each array entry, get its full text
    let ratingValue = $(`#${r}`).text();
    icon = "<i class='text-amber fas fa-star mr-1'></i>";
    // For each array entry, insert icon repeated by the Full Number rating value and the full text of the rating value
    document.getElementById(r).innerHTML = icon.repeat(`${ratingValueForIcon}`) + ratingValue;
}
```

This had the desired effect: all Recipe Box cards on the "All Recipe Boxes" page now display the approproate number of stars:

<img src="documentation/screenshots/testing/star-rating-all-boxes.png">

From here, the devloper could delete the original JavaScript code from the individual Recipe Box page, add the class `rating` to the rating section of the HTML, then create a separate script file in the `includes` folder and call the script from both the `products.html` template and the individual `product_detail.html` template.

### Changing photos on  blog articles

The developer feels that this is a community site, and as such, when a user adds an image to a blog article, the user should either be forced into crediting the image. The image can be either an image the user took, or an image downloaded from the internet or elsewhere. Whichever, a credit should be given. 

The developer originally set the blog app's Post model to have an obligatory Image Credit CharField. However, doing so threw up a number of conundrums.

For example, what if the user was not adding an image, but allowing the banner image to be the page background for the blog article? Why would the user need to credit this?

Further, if later the user decided to edit the post and choose to remove an added image, the Image Credit field would still be needed. 

Thus, the developer realised that the best way to avoid these issues was to change the Post model to allow Image Credit to be blank and null. He then wrote some JavaScript to force the user to add a credit when an image was added. This JavaScript was appended to the JavaScript used in the original Boutique Ado project, on which this project is based.

The original script:

```
<script>
    $('.btn-file').children('input').addClass('new-image');
    $('.new-image').change(function() {
        let file = $('.new-image')[0].files[0];
        $('#filename').text(`Image will be set to ${file.name}`);
    })
</script>
```

The develpoer's amended version:

```
<script>
    // Hide the Image Credit input box on the add post form
    $('#div_id_image_credit').css('display', 'none');
    // Original script
    $('.btn-file').children('input').addClass('new-image');
    $('.new-image').change(function() {
        let file = $('.new-image')[0].files[0];
        $('#filename').text(`Image will be set to ${file.name}`);
        // If user adds image, show Image credit box
        $('#div_id_image_credit').css('display', 'block');
        // Add * to show user the credit must be added
        $('label[for="id_image_credit"]').text('Image Credit*');
        // Require input
        $('input[name="image_credit"]').prop('required', true);
    })
</script>
```

This takes care of when a user adds an image.

However, when the user edits the post, the above script was not sufficient, since it would not force the user to append the credit if the image was changed. Furthermore, it does not remove the Image Credit if an image is removed. Thus, a further script was appended on the `edit_post.html` template:


```
<script>
    $(document).ready(function() {
        // Change element boders to amber so user immediately knows (s-he is editing rather than adding a post, but ensure that global search is still green
        $('input').not('input[name="q"]').removeClass('border-green').addClass('border-amber');
        $('select').removeClass('border-green').addClass('border-amber');
        $('textarea').removeClass('border-green').addClass('border-amber');
        $('.btn-file').removeClass('btn-green').addClass('btn-amber');

        // Code block from above
        $('.btn-file').children('input').addClass('new-image');
        $('#div_id_image_credit').css('display', 'none');
        $('.new-image').change(function() {
            let file = $('.new-image')[0].files[0];
            $('#filename').text(`Image will be set to ${file.name}`);
            $('input[name="image_credit"]').val('');
            $('#div_id_image_credit').css('display', 'block');
            $('label[for="id_image_credit"]').text('Image Credit*');
            $('input[name="image_credit"]').prop('required', true);
        })
        // Handle clicks of "Remove" button
        // Clicking once = remove image. Clicking twice overrides remove function, keeping the original image
        let count = 0;
        // Get Image Credit input value text
        imageCreditValue = $('input[name="image_credit"]').val()
        $('#image-clear_id').on('change', function() {
            // if clicks divisible by 2 (keep image)
            if (count % 2 === 0) {
                // set Image Credit input to not be required, thus maintaining original credit
                $('input[name="image_credit"]').val('');
                $('input[name="image_credit"]').prop('required', false);
            } 
              // otherwise
              else if (count % 2 != 0) {
                // re-insert original Image Credit input value
                $('input[name="image_credit"]').val(imageCreditValue);
                $('input[name="image_credit"]').prop('required', true);
            }
            count += 1;
        })
    })
</script>
```

The above script means that if a user changes an image to a post, the user is forced to add a credit. 

Otherwise, if a user removes an image, the Image Credit is removed, and is set to a blank string. It also allows for users clicking the "Remove" button accidentally: instead of being forced to reinsert an Image Credit value manually, the code handles this automatically.

The developer tested this code to destruction on the live site, and has verified that with each option, (add image, remove image, handle accidental clicks) the correct Image credit is shown on the blog post's page. If a user posts an image, the credit is displayed. If the image is removed, no credit is displayed (since the default site banner image is being used). 

## Search

Originally, the developer was going to have a search page for each section of the site. Thus, if a user is visiting the blog articles, searching would reveal the appropriate results. Likewise, if a user is visiting Recipe Boxes, searching would return only results from the "commercial" side of the site.

However, it soon became apparent that this would be too complicated for users. Some users may not remember whether that are visiting the commercial side or the community side. Others, however, may be reading an article on the community side (the blog) and decide to look for Recipe Boxes that might be similar to the blog article. Thus, for example, the site contains a blog article about the dish "Adobo" and a Recipe Box for "Chicken Adobo". It would be frustrating for the user to search for the equivalent matching product (or article, depending where the user was starting from) but not be able to find it in the search.

Thus the developer decided to make a dedicated search tempate, that would return all concerned seacrh results.

The developer however thought it best that searching by tag or cateogory would take the user to the dedicated "side" of the website. Since tags are not featured on Recipe Boxes, but categories are, clicking a tag takes the user to the community side, for example.

## Blog Tags and Categories

Whereas the commercial side of the website is controlled by the site admin, the blog and recipe side is designed to be communal. Thus, admin decides upon categories for Recipe Boxes, and these are "set in stone", so to speak. They are categorised by region, by diet, and by meal.

However, blogs are different to products in the way that they are grouped. Just as "Asian" might be ideal as a category, it does not necessarily work well as a tag. It would be better to allow a further tag, such as "rice", to describe the particular article. Doing so means that users can skip from categories to tags and from tags to categories.

This clearly means that it should be the post author who decides upon tags to include. And it was here that the developer had the most difficulty with his code.

Since this is the developer's first Django project, it is fair to say that the developer has found Django to be at times extremely complicated. At other times, it is a joy to use. It is fir this reason that the developer is not going to expand on every error or problem he encountered while writing the code for adding and editing tags and categories. However, he is going to document his many tries in the beneath code block:

```
@login_required
def add_post(request):
    """ Add a post to the blog """
    if request.method == 'POST':
        """ Gets username as author """
        author = get_object_or_404(User, id=request.user.id)
        # new_tag_form = NewTagsForm(request.POST)
        posts_form = BlogPostForm(request.POST, request.FILES)
        form_temp = posts_form.save(commit=False)
        form_temp.author = author
        # Check button for adding further posts
        add_more_posts = request.POST.getlist('add-more-posts')
        # print(request.POST)
        if posts_form.is_valid():
            # form_temp = posts_form.save(commit=False)
            postsform = posts_form.save()
            new_post = Post.objects.get(id=postsform.id)
            new_tags_form = NewTagsForm(request.POST)
            if new_tags_form.data['tagname']:
                # x = new_tags_form.save(commit=False)
                # print(x.id)
                new_tagname = new_tags_form.data['tagname']
                # print(new_tagname)
                tagname_collection = Tag.objects.all()
                # print(tagname_collection)
                # existing_tagname = Tag.objects.get(tagname__in=new_tagname)
                # print(existing_tagname)
                existing_tagname = Tag.objects.filter(tagname=new_tagname)
                if existing_tagname:
                    existing_tagname_id = tagname_collection.get(id__in=existing_tagname)
                    new_post.tag.add(existing_tagname_id)
                # print(exisiting_tagname_id)
                if not existing_tagname:
                    # tagname_collection.insert_one(new_tagname)
                    new_tags_form.is_valid()
                    newtag = new_tags_form.save()
                # print(newtag.id)
                    new_post.tag.add(newtag)
                # else:
                    # new_post.tag.add(existing_tagname_id)
                    # new_post.tag.add(exisiting_tagname_id)
                    # new_post.tag.add(existing_tagname)
                # postsform.save()
                # tagname = new_tags_form.data['tagname']
                # NewTagsForm.save()
                # new_tags_form =
            # new_tag_form = NewTagsForm(request.POST)
            # new_tag_form.GET.
            # print(new_tag_form.tagname)
            # NewTagsForm(request.POST)
            # print(NewTagsForm)
            # print(request.POST)
            # if new_tag_form.is_valid():
                # new_tag = new_tag_form.save(commit=False)
                # tagname = Post.objects.create(new_tag)
                # form_temp.tag.add(tagname)
                # print(new_tag)
                # print(new_tag.id)
                # newtag = new_tag.id
                # print(newtag)
                # new_tag_id = Tag.objects.get(id=new_tag.id)
                # print(new_tag_id)
                # form_temp.tag = new_tag_form
                # new_tag = request.new_tag_form.get("tagname")
                # new_tag = get_object_or_404(Tag, id=request.tagname)
                # form_temp.tag.add(new_tag.id)
                # print(form_temp.tag)
                # form.tag.add(newtag)
                # saved_form = posts_form.save()
                # if newtag is None:
                # posts_form.save()
                # new_tag_form.save()
                # saved_form.tag.add(newtag)
                # new_tag.delete
            # else:
                # posts_form.save()
                # saved_form = posts_form.save()
                # new_tag_form.save()
                # saved_form.tag.add(newtag)
            new_category_form = NewCategoriesForm(request.POST)
            if new_category_form.data['friendly_name']:
                """new_category_form.is_valid()
                newcategory = new_category_form.save()
                new_post.category.add(newcategory)"""
                new_category_name = new_category_form.data['friendly_name']
                category_collection = Category.objects.all()
                existing_category_name = (
                    Category.objects.filter(friendly_name=new_category_name))
                if existing_category_name:
                    existing_category_name_id = (
                        category_collection.get(id__in=existing_category_name))
                    new_post.category.add(existing_category_name_id)
                if not existing_category_name:
                    new_category_form.is_valid()
                    newcategory = new_category_form.save()
                    new_post.category.add(newcategory)
            messages.success(request, 'Successfully added post!')
            if add_more_posts:
                return redirect(reverse('add_post'))
            else:
                return redirect(reverse('blog-articles'))
        else:
            messages.error(request, 'Failed to add your post \
                Please ensure the form is valid.')
    else:
        new_category_form = NewCategoriesForm
        new_tag_form = NewTagsForm
        posts_form = BlogPostForm
    template = 'blog/add_post.html'
    context = {
        'posts_form': posts_form,
        'new_tag_form': new_tag_form,
        'new_category_form': new_category_form,
    }

    return render(request, template, context)
```

With each piece of commented out code in the above code block, the developer added blog articles and tested the functionality. 

The final code block reads as such:

```
@login_required
def add_post(request):
    """ Add a post to the blog """

    if request.method == 'POST':
        """ Gets username as author """
        author = get_object_or_404(User, id=request.user.id)

        """ Retrieve form data """
        posts_form = BlogPostForm(request.POST, request.FILES)
        form_temp = posts_form.save(commit=False)

        """ append user (post author) to form for submitting """
        form_temp.author = author

        """ Check button for adding further posts """
        add_more_posts = request.POST.getlist('add-more-posts')

        
        if posts_form.is_valid():
            postsform = posts_form.save()
            new_post = Post.objects.get(id=postsform.id)

            """ Handle new vs existing tags """
            new_tags_form = NewTagsForm(request.POST)
            if new_tags_form.data['tagname']:
                new_tagname = new_tags_form.data['tagname']
                tagname_collection = Tag.objects.all()
                existing_tagname = Tag.objects.filter(tagname=new_tagname)
                if existing_tagname:
                    existing_tagname_id = tagname_collection.get(id__in=existing_tagname)
                    new_post.tag.add(existing_tagname_id)
                if not existing_tagname:
                    new_tags_form.is_valid()
                    newtag = new_tags_form.save()
                    new_post.tag.add(newtag)
                
            """ Handle new vs exiting categories """
            new_category_form = NewCategoriesForm(request.POST)
            if new_category_form.data['friendly_name']:
                new_category_name = new_category_form.data['friendly_name']
                category_collection = Category.objects.all()
                existing_category_name = (
                    Category.objects.filter(friendly_name=new_category_name))
                if existing_category_name:
                    existing_category_name_id = (
                        category_collection.get(id__in=existing_category_name))
                    new_post.category.add(existing_category_name_id)
                if not existing_category_name:
                    new_category_form.is_valid()
                    newcategory = new_category_form.save()
                    new_post.category.add(newcategory)

            messages.success(request, 'Successfully added post!')

            """ Handle redirect according to whether Further Posts is checked or not """
            if add_more_posts:
                return redirect(reverse('add_post'))
            else:
                return redirect(reverse('blog-articles'))
        else:
            messages.error(request, 'Failed to add your post \
                Please ensure the form is valid.')
    else:
        new_category_form = NewCategoriesForm
        new_tag_form = NewTagsForm
        posts_form = BlogPostForm
    
    template = 'blog/add_post.html'
    
    context = {
        'posts_form': posts_form,
        'new_tag_form': new_tag_form,
        'new_category_form': new_category_form,
    }

    return render(request, template, context) 
```

The result of the above code is that a user can either choose from the list of categories or tags AND also add their own. The code recognises whether user entered tags/categories are on the pre-existing list. If they are, they are not duplicated. If they are not, they are added to the corresponding model (Tag or Category) and to the Post object itself.

There is one still to be resolved situation regarding this code, however, and this will be resolved in the developer's future plans for the site. 

The developer realises that any text entered as tags or categories is treated as a string, rather than as array entries. Thus, if a user creates a post about chocolate milkshakes and chooses tags as "chocolate milk milkshake" the resulting tag is just that, rather than ["chocolate", "milk", "milkshake"]. 

The developer feels the solution to this might be the Django "taggable "add-on, but has decided this will be looked into at a further date.

With the above code working fully, it was amended to suit the edit_post() view and tested fully there too.

(As an aside to the above, since both admin and post authors can edit posts, the developer has allowed a blue colour to be used for admin controlled changes. For instance, when admin add or edit Recipe Boxes, a blue color is used to denote that this is "admin only", so to speak. Since admin are able to edit user-posted material, the developer has deliberately used different colours for editing blog articles, to distinguish between posts posted by admin, and posts posted by users. The end user does not see this differentiation: when a user adds a post, green is used, editing is amber, and deleting is red, as set out in the colour choices already mentioned in this README. Only admin ever see blue.)

## Formset and Inlines
### Formset
The Recipes models consist of 4 models: Tag, Category, Recipe and Ingredient. While Tag and Category are essentially the same as for the Blog, the developer has chosen not to relate these (between the Blog app and the Recipes app) for now. Depending on the evolution of the project, the developer may choose to relate them in further updates.

The developer has chosen for the Recipe model to be related to the Ingredient model via a ForeignKey relationship. The developer has chosen to do this because recipes do not have a fixed number of ingredients. An omelette necessitates one ingredient (the egg), whereas spaghetti bolognese necessitates many more. 

Rendering the Recipe model in admin shows the ingredients as inlines. The javascript allows for users to add a maximum of 25 ingredients to a particular recipe, while a minimum of one is also being set.

Writing the add_recipe() view proved to be fairly straightfoward (even if the developer admits to reading a tutorial for this, and amending the code to suit his needs). The code for adding a recipe using the Recipe form and its associated inline formset is beneath:

```
if recipe_form.is_valid():
	recipe = recipe_form.save()
	formset = IngredientFormSet(request.POST, instance=recipe)
	if formset.is_valid():
		formset.save()
```

But the developer had issues when it came to editing recipes using this code. While editing the other attributes of the recipe was possible, nothing the developer tried would update the ingredients. In other words, if a recipe was editied, the ingredients would always remain as those added when the recipe was created.

Eventually, after much searching, after having spoken to other developers, the developer found a way to log the error to the console. The editing was not retrieving the form.id from the forms, and thus could not update itself. 

The developer found a way of inserting these form ids into the forms of the formset by adding 

`{{ formset.id }}`

to both the add_recipe template and the edit_recipe template, effectively creating an id for each form and retrieving it when editing.

To his astonishment, this simple solution worked, and recipe ingredient updating functioned.

While researching this project, the developer toyed with the idea of using dynamic formsets, but decided instead to set a maximum and minimum for the form.

The reason for this became evident when editing a recipe. For the dynamic formset, as originally intended, the devloper had again followed an online tutorial and amended his code to suit his needs. The code is reproduced below, in order to document the problems the developer had, and how he solved the problem. The code does not feature in the finsihed project.

```
<script>
    // Dynamic form credit: https://engineertodeveloper.com/dynamic-formsets-with-django/
    const ingredientForm = document.getElementsByClassName("ingredient-form");
    const mainForm = document.querySelector("#main_form");
    const addIngredientFormBtn = document.querySelector("#add-ingredient-form");
    const recipeDirections = document.querySelector('.more-ingredients-row');
    const totalForms = document.querySelector("#id_ingredients-TOTAL_FORMS");

    let formCount = ingredientForm.length + 1 ;
    console.log(formCount)

    function updateForms() {
        let count = 0;
        for (let form of ingredientForm) {
            const formRegex = RegExp(`ingredients-(\\d){1}-`, 'g');
            form.innerHTML = form.innerHTML.replace(formRegex, `ingredients-${count++}-`)
        }
    }

    addIngredientFormBtn.addEventListener("click", function (event) {
        event.preventDefault();

        const newIngredientForm = ingredientForm[0].cloneNode(true);
        const formRegex = RegExp(`ingredients-(\\d){1}-`, 'g');

        formCount++;
        console.log(formCount)

        newIngredientForm.innerHTML = newIngredientForm.innerHTML.replace(formRegex, `ingredients-${formCount}-`);
        mainForm.insertBefore(newIngredientForm, recipeDirections);
        totalForms.setAttribute('value', `${formCount + 1}`);
    });

    mainForm.addEventListener("click", function (event) {
        if (event.target.classList.contains("delete-image-form")) {
            event.preventDefault();
            event.target.parentElement.remove();
            formCount--;
            updateForms();
            totalForms.setAttribute('value', `${formCount + 1}`);
        }
    });
</script>

```

As can be seen from the above code, each time a user click the Add Ingredient button, an extra form row is created. Setting the `extra=`value to a certain number in the forms.py renders the number of original forms to be displayed. Thus, if `extra=`is set to one, one form will be displayed. Likewise, if set to 3, three extra forms will be displayed. This is of course a wonderful solution for *creating* recipes, but not so when editing them.

Since a recipe is being saved before it can be edited, clicking the Add Ingredient button on the edit page would essntially clone the whole ingredients list and add the relevant extra rows. 

Thus, if a saved recipe has 20 ingredients, the cloning would duplicate those ingredients and then add the relevant extra rows.

The user would then have to manually delete each cloned ingredient.

The developer thought about adding an extra hidden formset, so that clicking the Add Ingredient button would clone this empty form. While the idea works in principle, and while the developer was able to increment the ids of the clones (so that the first added new ingredient would have a correspondingly incremented id value), the first new form would always have a duplicate of index 0.

To demonstrate:

A recipe has 3 ingredients:

Ingredient 1 (index 0)

Ingredient 2 (index 1)

Ingredient 3 (index 2)

User clicks "Add Ingredient"

New form (index 0)

New form 1 (index 3)

New form 2 (index 4)

The developer was researching how to amend this when he noticed something else in the outputted html of dev tools.

Since the hidden form was a duplicate of the original empty form, it would share the same id as the first form.

This is of course bad practise, and the developer surmised that this issue would raise more problems than it would solve. The developer knew that if a user entered an ingredient into New Form (index 0), again nothing would be saved due to duplcation of the index. Solving this AND the issue of duplicated ids convinced the developer to find a different solution.

It is for this reason that the developer chose to set `extra=`in the form and write some custom JavaScript to handle the form display.

The JavaScript for the add_recipe template is beneath:

```
let addButton = $('#add-ingredient-form');
let ingredients = $('.ingredients');
let count = 0;
ingredients.slice(5).toggle();
addButton.on('click', function() {
    event.preventDefault();

    count++;
    if (count == 1) {
        ingredients.slice(5, 10).toggle();
    }
    if (count == 2) {
        ingredients.slice(10, 15).toggle();
    }
    if (count == 3) {
        ingredients.slice(15, 20).toggle();
    }
    if (count == 4) {
        ingredients.slice(20, 25).toggle();
        addButton.toggle();
    }
})
```

From the start we have 25 available forms, as `extra=25` is set in the form's py file.

On page load, 5 of these are displayed. With each click of the "Add Ingredient" button, a further five are unhidden until arriving at a maximum of 25 forms. At this point, the "Add Ingredient" button is hidden and the user can add no more ingredients.

For editing, a different script was written to handle displaying of already added ingredients and further ingredients.

Firstly, the count of the exisiting ingredients is perfomed by adding 

`<p class="ingredient-count" hidden>{{ ingredient_count }}</p>`

to the HTML.

```
let addButton = $('#add-ingredient-form');
let ingredients = $('.ingredients');
let deleteButton = $('.delete-button')
let ingredientCount = $('.ingredient-count').text()
ingredientTotal = parseInt(ingredientCount)
let ingredientCountPlusFive = ingredientTotal + 5;
let ingredientCountPlusTen = ingredientTotal + 10;
let ingredientCountPlusFifteen = ingredientTotal + 15;
let ingredientCountPlusTwenty = ingredientTotal + 20;
let ingredientCountPlusTwentyFive = ingredientTotal + 25;
let count = 0;
ingredients.slice(ingredientTotal).toggle();
deleteButton.slice(ingredientTotal).toggle();
addButton.on('click', function() {
    event.preventDefault();

    count++;
    if (count == 1) {
        ingredients.slice(ingredientTotal, ingredientCountPlusFive).toggle();
        deleteButton.slice(ingredientTotal, ingredientCountPlusFive).toggle();
        if (ingredientCountPlusFive >= 25) {
            ingredients.slice(25).hide();
            deleteButton.slice(25).hide();
            addButton.toggle();
        }
    }
    if (count == 2) {
        ingredients.slice(ingredientCountPlusFive, ingredientCountPlusTen).toggle();
        deleteButton.slice(ingredientCountPlusFive, ingredientCountPlusTen).toggle();
        if (ingredientCountPlusTen >= 25) {
            ingredients.slice(25).hide();
            deleteButton.slice(25).hide();
            addButton.toggle();
        }
    }
    if (count == 3) {
        ingredients.slice(ingredientCountPlusTen, ingredientCountPlusFifteen).toggle();
        deleteButton.slice(ingredientCountPlusTen, ingredientCountPlusFifteen).toggle();
        if (ingredientCountPlusFifteen >= 25) {
            ingredients.slice(25).hide();
            deleteButton.slice(25).hide();
            addButton.toggle();
        }
    }
    if (count == 4) {
        ingredients.slice(ingredientCountPlusFifteen, ingredientCountPlusTwenty).toggle();
        deleteButton.slice(ingredientCountPlusFifteen, ingredientCountPlusTwenty).toggle();
        if (ingredientCountPlusTwenty >= 25) {
            ingredients.slice(25).hide();
            deleteButton.slice(25).hide();
            addButton.toggle();
        }
    }
    if (count == 5) {
        ingredients.slice(ingredientCountPlusTwenty, ingredientCountPlusTwentyFive).toggle();
        deleteButton.slice(ingredientCountPlusTwenty, ingredientCountPlusTwentyFive).toggle();
        if (ingredientCountPlusTwentyFive >= 25) {
            ingredients.slice(25).hide();
            deleteButton.slice(25).hide();
            addButton.toggle();
        }
    }    
})
```

On rendering the page, all of the existing ingredients are displayed to the user. Then, with each click of the "Add Ingredient" button, 5 more forms are displayed. If the number of extra forms is greater than 25 upon each click of the button, the button is hidden, and the user can add no further ingredients.

While both adding recipes and editing them function as they should, the developer freely admits that there is without doubt a better way to go about achieving this functionality. This is, however, his first Django project and he has found some of the functionality of Django (and further online resources such as StackOverflow) to be confusing to a novice.

Thus, the developer is leaving the code as is, and will revisit and amend it when he has a better, fuller understanding of Django and all Django can offer.

### Inlines
Regarding the functionality of ensuring ingredients are listed for each recipe, the developer admits to also being confused. Unless he has misunderstood something, he believes that he has set ingredient quantities, units and names to be required. his is indeed what the HTML page renders. 

Thus, the developer was surprised to find that he could indeed add a recipe without ingredients. The cause of this may originate from testing the above functionality: to get the above working the developer tried hundreds of different things. The developer may have missed "resetting" a line of code after trying and failing.

Again, when the developer better understands Django, this will be revisited.

For now, however, the devloper has added the following JavaScript in order to force a required state for the FIRST ingredient formset (since we do not want to force a user to have to add exactly 25 ingredients for each recipe):

```
$('input[name="ingredients-0-quantity"]').prop('required', true);
$('input[name="ingredients-0-unit"]').prop('required', true);
$('input[name="ingredients-0-name"]').prop('required', true);
```

## Known Bugs
If a user creates multiple versions of the same item (whether that be a recipe, a blog post or a Recipe Box) and assigns each with different categories or tags, upon clicking categories or tags associated with the duplicated entries, the template rendering can become confused. 

The develpoer realises that one solution for this is to add `unique=True` to the name or title of products, articles or recipes. However, while the site is still small and while the developer want to encourage users to participate in the community side of the site, the developer feels that adding `unique=True`may discourage users from participating. There are of course many different ways to make a spaghetti bolognese and stopping a user from creating such a recipe because the name is taken will discourage the user from further participation.

Thus, the developer is choosing to leave this for now.

## Back End
### RECIPE BOXES Database Models
#### Category

| Key  | Type Field  | Relationship  | Blank  | Null  |
|:----------|:----------|:----------|:----------|:----------|
| name    | CharField    |  -     |  -     |  -     |
| friendly_name    | CharField    |  -     | True    | True    |
| sku    | CharField    |  -     | True    | True    |

#### Product
| Key  | Type Field  | Relationship  | Max Digits  | Decimal Places  | Blank  | Null  |Default  |
|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:----------|
| category    | ManyToManyField    | Categories    |  -     |  -     |  -     |  -     |  - |
| sku    | CharField    |  -     |  -     |  -     | True    | True    | - |
| name    | CharField    |  -     |  -     |  -     |  -     |  -     |  -  |
| description    | TextField    |  -     |  -     |  -     |  -     |  -     |  - |
| price    | DecimalField    |  -     | 6    | 2    |  -     |  -     |  -  |
| rating    | DecimalField    |  -     | 6    | 2    | True    | True    |  -  |
| image_url    | URLField    |  -     |  -     |  -     | True    | True    |  -  |
| image_credit    | CharField    |  -     |  -    |  -     | True    | True    |  - |
| image    | ImageField    |  -     |  -     |  -     | True    | True    |  -  |
| has_gluten    | BooleanField    |  -     |    -   |  -     | True    | True    | False |
| gluten_free_option    | BooleanField    |  -     |  -     |  -     | True    | True    | False|
 
### USER Database Models
| Key  | Type Field  | Relationship  | Max Digits  | Blank  | Null  | Default  |
|:----------|:----------|:----------|:----------|:----------|:----------|:----------|
| user    | OneToOneField    | User    | -    | -    | -    | -    |
| default_full_name    | CharField    | -    | 50    | True    | -    | ""    |
| default_phone_number    | CharField    | -    | 20    | True    | -    | ""    |
| default_street_address1    | CharField    | -    | 80    | True    | -    | ""    |
| default_street_address2    | CharField    | -    | 80    | True    | -    | ""    |
| default_town_or_city    | CharField    | -    | 40    | True    | -    | ""    |
| default_county    | CharField    | -    | 80    | True   | -    | ""    |
| default_postcode    | CharField    | -    | 20    | True    | -    | ""    |
| default_country    | CountryField    | -    | -    | True    | -    | ""    |


### BLOG Database Models
#### Category

| Key  | Type Field  | Relationship  | Blank  | Null  |
|:----------|:----------|:----------|:----------|:----------|
| name    | CharField    |  -     |  -     |  -     |
| friendly_name    | CharField    |  -     | True    | True    |
| sku    | CharField    |  -     | True    | True    |

#### Tag
| Key  | Type Field  | Max Length  |
|:----------|:----------|:----------|
| tagname    | CharField    | 254    |

#### Posts
| Key  | Type Field  | Relationship  | Max Length  | auto_now  | auto_now_add  | Null  | Blank  | Default  | related_name  |
|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:-----------|
| author    | ForeignKey    | User    | -    | -    | -    | -    | -    | -    | blog_posts    |
| title    | CharField    | -    | 254    | -    | -    | -    | -    | -    | -    |
| category    | ManyToManyField    | Category    | -    | -    | -    | -    | True    | -    | -    |
| tag    | ManyToManyField    | Tag    | -    | -    | -    | -    | True    | -    | -    |
| tagline    | CharField    | -    | 254    | -    | -    | -    | -    | -    | -    |
| image    | ImageField    | -    | -    | -    | -    | True    | True    | -    | -    |
| image_credit    | CharField    | -    | 254    | -    | -    | -    | True    | ""    | -    |
| content	| TextField	| - | - | - | - | - | - | - | - |
| date    | DateTimeField    | -    | -    | -    | True    | -    | -    | -    | -    |
| date_posted    | DateTimeField    | -    | -    | -    | -    | True    | True    | timezone.now    | -    |
| date_edited    | DateTimeField    | -    | -    | True    | -    | -    | -    | -    | -    |

### RECIPE Database Models
#### Category

| Key  | Type Field  | Relationship  | Blank  | Null  |
|:----------|:----------|:----------|:----------|:----------|
| name    | CharField    |  -     |  -     |  -     |
| friendly_name    | CharField    |  -     | True    | True    |
| sku    | CharField    |  -     | True    | True    |

#### Tag
| Key  | Type Field  | Max Length  |
|:----------|:----------|:----------|
| tagname    | CharField    | 254    |

#### Recipe
| Key  | Type Field  | Relationship  | Related Name  | on_delete  | default  | blank  | null  | max_length  | auto_now_add  |
|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:-----------|
| author    | ForeignKey    | User    | recipe_posts    | CASCADE    | ""    | True    | True    | -    | -    |
| title    | CharField    | -    | -    | -    | -    | -    | -    | 150    | -    |
| intro    | CharField    | -    | -    | -    | -    | -    | -    | 254    | -    |
| prep_time    | CharField    | -    | -    | -    | -    | -    | -    | 20    | -    |
| total_time    | CharField    | -    | -    | -    | ""    | True    | -    | 20    | -    |
| cook_time    | CharField    | -    | -    | -    | ""    | False    | -    | 20    | -    |
| servings    | IntegerField    | -    | -    | -    | -    | -    | -    | -    | -    |
| category    | ManyToManyField    | Category    | -    | -    | -    | True    | -    | -    | -    |
| tag    | ManyToManyField    | Tag    | -    | -    | -    | True    | -    | -    | -    |
| directions    | RichTextField    | -    | -    | -    | -    | True    | True    | -    | -    |
| image    | ImageField    | -    | -    | -    | -    | True    | True    | -    | -    |
| image_credit    | CharField    | -    | -    | -    | ""    | True    | -    | -    | -    |
| date    | DateTimeField    | -    | -    | -    | -    | -    | -    | -    | True    |
| date_posted    | DateTimeField    | -    | -    | -    | timezone.now    | True    | True    | -    | -    |
| date_edited    | DateTimeField    | -    | -   | -    | -    | -    | -    | -    | True    |
| recipe_box    | OneToOneField    | Product    | box    | SET_NULL    | -    | True    | True    | -    | -    |
| vote_count    | IntegerField    | -    | -    | -    | 0    | -    | -    | -    | -    |
| votes    | ManyToManyField    | User    | recipe_post_votes    | -    | -    | True    | -    | -    | -    |
| mail_sent    | BooleanField    | -    | -    | -    | False    | True    | True    | -    | -    |
| discount_code    | CharField    | -    | -    | -    | ""    | True    | -    | 6    | -    |

#### Ingredients
| Key  | Type Field  | Relationship  | Related Name  | on_delete  | default  | blank  | max_length  |
|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:----------|
| quantity    | FloatField    | -    | -    | -    | ""    | True    | -    |
| unit    | CharField    | -    | -    | -    | ""    | True    | 15    |
| name    | CharField    | -    | -    | -    | ""    | True    | 150    |
| preparation    | CharField    | -    | -    | -    | ""    | True    | 150    |
| recipe    | ForeignKey    | Recipe    | ingredients    | CASCADE    | -    | -    | -    |

### ORDER Database Models

| Key  | Type Field  | Relationship  | Related Name  | on_delete  | max_length  | max_digits  | editable  | null  | blank  | blank_label | decimal_places |
|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:----------|:-----------|:-----------|:-----------|
| order_number    | CharField    | -    | -    | -    | 32    | -    | False    | False    | -    | - | - |
| user_profile    | ForeignKey    | UserProfile    | orders    | SET_NULL    | -    | -    | -    | True    | True    | - | - |
| full_name    |CharField    | -    | -    | -    | 50    | -    | -    | False    | False    | - | - |
| email    | EmailField    | -    | -    | -    | 254    | -    | -    | False    | False    | - | - |
| phone_number    | CharField    | -    | -    | -    | 20    | -    | -    | False    | False    | - | - |
| street_address1    | CharField    | -    | -    | -    | 80    | -    | -    | False    | False    |- | - |
| street_address2    | CharField    | -    | -    | -    | 80    | -    | -    | True    | True    |- | - |
| town_or_city    | CharField    | -    | -    | -    | 40    | -    | -    | False    | False    |- | - |
| county    | CharField    | -    | -    | -    | 80    | -    | -    | True    | True    |- | - |
| postcode    | CharField    | -    | -    | -    | 20    | -    | -    | True    | True    |- | - |
| country    | CountryField    | -    | -    | -    | -    | -    | -    | False    | False    | Country* | - |
| date    | DateTimeField    | -    | -    | -    | -    | -    | -    | -    | -    |- | - |
| delivery_cost    | DecimalField    | -    | -    | -    | -    | 6    | -    | False    | -    |- | 2 |
| order_total    | DecimalField    | -    | -    | -    | -    | 10    | -    | False    | -    |- | 2 |
| vote_discount_applied    | DecimalField    | -    | -    | -    | -    | 10    | -    | False    | -    |- | 2 |
| grand_total    | DecimalField    | -    | -    | -    | -    | 10    | -    | False    | -    |- | 2 |
| original_bag    | TextField    | -    | -    | -    | -    | -    | -    | False    | -    |- |  - |
| stripe_pid    | CharField    | -    | -    | -    | 254    | -    | -    | False    | False    |- |  - |

### Notes on models
#### Category, Tag and their associate models
The developer realizes that he has used seemingly the same models for Products, Blog and Recipes. There is a reason for the duplication:

The developer wants to keep control of the listings of Recipe Boxes. He has allowed adding of Categories and Tags for Recipes and Blog articles, but wishes to keep some semblance of order according to the menu items in the navigation for Recipe Boxes. While it is possible to filter Recipe Boxes by their Categories by clicking on a category, the developer does not wish to leave users the possibility of having almost identical categories in the Recipe Box list of categories (ie, Mediterranean vs Medditerannean). Keeping this semblance of order is less important for the community side of the site, as it is the community who "control" their input.

#### Order: null & true values

Django frowns upon `null=True, blank=True` values.

The Django documentation states that `default=""` should be used instead. While the developer has done so for every other model of this project, he found that doing so in the Order model caused Stripe to fail in its sending of webhooks.

The developer believes that this is a case of "functionality trumps warnings", and has decided to leave the Order model with these warnings, for the time being. Once the developer is more at ease with both Stripe and Django, he will revisit this. See "Future Plans".

#### ckeditor in Recipe, Product and Blog models

The developer looked for a way to make ckeditor functionality `null=False, blank=False`, but found that when he did so, this caused his forms to fail. Instead, he has added `required=True` to all forms using ckeditor.

#### Product & Recipe relationship

The developer is aware that as his models are now, he has to add both Recipes and Products in two different places (both in admin and in the HTML rendering). To alleviate any errors caused if admin add one but not the other, the developer has used an `if`statment in the HTML:

```
<h3 class="subtitle">What's in the box?</h3>
    <ul class="list-group">
        <li class="list-group-item border-0 p-0">
            <i class="far fa-check-square text-green"></i> All the 
            {% if product.box.id %}
                <a class="text-green" href="{% url 'recipe' product.box.id %}">ingredients</a>
            {% else %}
                ingredients
            {% endif %} to make this recipe
        </li>
        <li class="list-group-item border-0 p-0 mb-3"><i class="far fa-check-square text-green"></i> The Recipe Card</li>
    </ul>
```

The developer is aware that this is perhaps not the ideal situation: in a perfect world, when admin adds a product, it should be automatically attached to its' associated recipe.

However, since it may be users themselves who add recipes but admin who add products, one is not necessarily associated with the other.

The developer is aware that this is a situation that needs to be revisted, and it is noted in the future plans for this project.

## Data Structures (JSON)
### PRODUCT
#### Categories

```
[
  {
    "model": "products.category",
    "pk": 1,
    "fields": {
      "name": "asian",
      "friendly_name": "Asian",
      "sku": "a1"
    }
  }
]
```

#### Products

```
[
  {
    "model": "products.product",
    "pk": 1,
    "fields": {
      "name": "",
      "sku": "rad000000001",
      "price": "10.99",
      "rating": "4.60",
      "has_gluten": false,
      "gluten_free_option": false,
      "description": "",
      "image_url": "",
      "image_credit": "",
      "image": "",
      "category": []
    }
  }
]
```

### BLOG
#### Categories

```
[
  {
    "model": "blog.category",
    "pk": 1,
    "fields": {
      "name": "asian",
      "friendly_name": "Asian",
      "sku": "bga1"
    }
  }
]
```

#### Tags

```
[
  {
    "model": "blog.tag",
    "pk": 1,
    "fields": {
      "tagname": "salad"
    }
  }
]
```

#### Post

```
[
  {
    "model": "blog.post",
    "pk": 2,
    "fields": {
      "author": 1,
      "title": "",
      "tagline": "",
      "image": "",
      "image_credit": "",
      "content": "",
      "date": "2021-07-25T12:38:15.089Z",
      "date_posted": "2021-07-25T14:21:49Z",
      "date_edited": "2021-08-12T19:26:08.999Z",
      "category": [],
      "tag": []
    }
  }
]
```

### RECIPE

#### Categories
```
[
  {
    "model": "recipes.category",
    "pk": 1,
    "fields": {
      "name": "asian",
      "friendly_name": "Asian",
      "sku": "ra1"
    }
  }
]
```

#### Tags

```
[
  {
    "model": "recipes.tag",
    "pk": 1,
    "fields": {
      "tagname": "salad"
    }
  }
]
```

#### Recipe

```
[
  {
    "model": "recipes.recipe",
    "pk": 128,
    "fields": {
      "author": 1,
      "title": "",
      "intro": "",
      "prep_time": "5 mins",
      "cook_time": "10 mins",
      "total_time": "15 mins",
      "servings": 4,
      "directions": "",
      "image": "",
      "image_credit": "",
      "date": "2021-08-13T17:19:35.957Z",
      "date_posted": "2021-08-13T17:19:35Z",
      "date_edited": "2021-08-21T13:51:32.714Z",
      "recipe_box": null,
      "vote_count": 2,
      "mail_sent": true,
      "discount_code": "",
      "category": [],
      "tag": [],
      "votes": []
    }
  }
]
```

#### Ingredient

```
[
  {
    "model": "recipes.ingredient",
    "pk": 93,
    "fields": {
      "quantity": 6,
      "unit": "whole",
      "name": "tomatoes",
      "preparation": "quartered",
      "recipe": 49
    }
  }
]
```

# Deployment
The deployment process listed below assumes that you have
1. A GitHub Account
2. A Heroku Account
3. A Stripe Account
4. An Amazon AWS Account 


## Deploying to Heroku
### Create the app at heroku.com 
1. Create app and give it a name, then select your region.
2. Add Posrtgres to the app by searching for it from the “Resources” tab
3. From the settings tab, click “Reveal Config Vars” and copy down the whole DATABASE_URL value

    `postgres://…`

4. Install the following in the CLI (terminal) in order to use Postgres

    ```
	pip3 install dj_database_url
    pip3 install psycopg2-binary
	```

5. Freeze the requirements

    `pip3 freeze > requirements.txt`

### Enable the postgres database in app/settings.py
1. Import dj_database_url in settings.py

    `import dj_database_url`

2. Comment out the default DATABASES configuration, replace the configuration with a call to dj_database_url.parse(), populating the string with the copied DATABASE_URL variable from above

	```
	# DATABASES = {
	#    'default': {
	#        'ENGINE': 'django.db.backends.sqlite3',
	#        'NAME': BASE_DIR / 'db.sqlite3',
	#    }
	# }

	DATABASES = {
    	'default': dj_database_url.parse('postgres://...')
	}
	```

### Migrating data

1. Run migrations and migrate database to Postgres from the CLI

	```
	python3 manage.py showmigrations
	python3 manage.py migrate
	```

2. Import database data (found in the fixtures folder of the app) via the CLI ensuring to import the dependency before the dependants (eg, categories before products)

	```
	python3 manage.py loaddata categories
	python3 manage.py loaddata products
	```

3. Assign superuser from the CLI, and answer prompts to create superuser name, email account and password

	`python3 manage.py createsuperuser`

4. Uncomment (restore) the default DATABASES configuration and remove the dj_database_url.parse(‘postgres://…') version to ensure the database url does not appear in version control

	```
	DATABASES = {
    	'default': {
        	'ENGINE': 'django.db.backends.sqlite3',
        	'NAME': BASE_DIR / 'db.sqlite3',
    	}
	}
	```

5. Commit all changes in the CLI

	```
	git add .
	git commit -m ‘Heroku and postgres set up, data migrated’
	git push
	```

### Using the environment for the DATABASES dictionary

1. Setting os.environ in app/settings.py to use postgres on the live site and sqlite when in development mode. Ensure that the `postges://...` value is NOT inserted in `dj_database_url.parse()`, but that `os.environ.get('DATABASE_URL'))` is entered as the value

	```
	if 'DATABASE_URL' in os.environ:
    	DATABASES = {
        	'default': dj_database_url.parse(os.environ.get('DATABASE_URL'))
    	}
	else:
    	DATABASES = {
        	'default': {
            	'ENGINE': 'django.db.backends.sqlite3',
            	'NAME': BASE_DIR / 'db.sqlite3',
        	}
    	}
	```
2. Install gunicorn via the CLI to act as webserver

	`pip3 install gunicorn`

3. Freeze requirements

	`pip3 freeze > requirements.txt`

### Create a web dyno to run gunicorn and serve the app

1. At system level, create the Procfile and add the following code to create the web dyno

	`web: gunicorn <app_name>.wsgi:application`

### Log in to heroku through the CLI and disable static file collection

1. Log in to heroku then follow prompts

	`heroku login -i`

2. Disable static collection

	Note that this process will clear images and styling from the finished app. These will be restored in the section 'Storing static files and images' (below)

	`heroku config:set DISABLE_COLLECTSTATIC=1`

	Note that if you have more than one heroku app, you will need to specify which app to disable the collection of static on

	`heroku config:set DISABLE_COLLECTSTATIC=1 app name-of-your-app`

### Allow heroku and GitHub (for development) to host the live site

1. In settings.py add the app to ALLOWED_HOSTS

	`ALLOWED_HOSTS = ['name-of-your-app.herokuapp.com', 'localhost']`

2. Commit and push changes to GitHub from the CLI

	```
	git add .
	git commit -m ‘Deployment to heroku’
	git push
	```

3. Initialize the heroku git remote

	`heroku git:remote -a name-of-your-app`

4. Push to heroku

	`git push heroku master`

5. Once the CLI has verified the deployment (`Verifying deploy... done. To https://git.heroku.com/name-of-your-app.git`), navigate to the app in the browser. If all is well, the site will be live, albeit with the styling removed. If not, you can use the command given on the page to check the logs

### Set up automatic deployment

1. Connect to GitHub fropm the "Deploy" tab in the app's heroku.com dashboard

2. Click enable automatic deploys

### Set SECRET_KEY variables in heroku and GitPod

1. For each of the above, generate a secret key (for example, [from here](https://miniwebtool.com/django-secret-key-generator/))

2. In the heroku dashboard naigate to the settings tab and add `SECRET_KEY` and its value to the Config Vars

3. In the GitPod settings ["variables" tab](https://gitpod.io/variables), repeat the above using a new value for the key

4. In app/settings.py replace the secret key setting with a call to get the key from the environment and use an empty string as a default

	`SECRET_KEY = os.environ.get('SECRET_KEY', '')`

### Debug settings

1. Set debug to be true only if there's a variable called development in the environment

	`DEBUG = 'DEVELOPMENT' in os.environ`

### Commit

1. In the CLI, add, commit and push as normal. The commits will be pushed both to GiuHub and heroku

	```
	git add .
	git commit -m ‘Deployment to heroku’
	git push
	```

## Storing static files and images

The app will now be live, but currently shows no styling or images, because `DISABLE_COLLECTSTATIC` is set to `1`. These steps will render the CSS styling and return the images to the live site.

### Create a bucket in Amazon AWS

1. Sign in to your Account [here](https://aws.amazon.com/) as a Root User

2. Search "s3" and then click "Create bucket"

3. Name the bucket to match the heroku app name

4. Select region from dropdown menu

5. Allow all public access by unchecking "Block all public access" and accepting the consequences. This is needed as we want the public to see the product images

6. Click "Create Bucket"

7. Open the bucket by clicking its link

### Bucket Properties

1. From the "Properties" tab, enable static website hosting

2. Input the default values for "Index Document" and "Error document"

3. Click "Save"

### Bucket Permissions

1. Add a Coors configuration to set up the required access between the Heroku app and this s3 bucket and then click "Save"

    ```
    [
      {
          "AllowedHeaders": [
              "Authorization"
          ],
          "AllowedMethods": [
              "GET"
          ],
          "AllowedOrigins": [
              "*"
          ],
          "ExposeHeaders": []
      }
    ]
    ```

2. Select “Policy generator” from the Bucket Policy section to create a security policy for the bucket. A new browser window will open

3. From the new browser window,  select "s3 Bucket Policy" in Step 1

4. Allow all Principals by adding an asterisk (`*`) to the Pricipal input area of Step 2

5. Choose "GetObject" from the Actions dropdown menu

6. From the OTHER browser window, copy the Bucket ARN and paste this into the "Amazon Resource Name (ARN)" box of the new window

7. Click "Add Statement" then in Step 3, click "Generate Policy"

8. Cope the Policy JSON Document into the Bucket Policy of the first window

9. Allow access to all resources in the bucket by adding a slash and an asterisk (`/*`) to the end of the Resource key

	`"Resource": "arn:(etc)/*",`

10. Click "Save Changes"

11. Set the Access control list object's permission for Everyone under the Public Access section

12. Accept that you acknowledge the effects

13. Click "Save Changes"

## Identity and Access Management

### Creating AWS Groups, Policies and Users in order to access the images and static files

1. From the "Services" dropdown of [aws.amazon.com](aws.amazon.com), search and select "IAM"

### Creating the User Group

1. Select "User Groups" from the dashboard

2. Click "Create group" and name the group. User groups manage permissions, so name the User Group accordingly (for example, `manage-name-of-your-app`)

3. Click "Save changes"

### Creating the Policy

1. Select "Policies" from the dashboard

2. Click "Create polocy" 

3. Click the "JSON" tab, then click "Import managed policy"

4. Search "s3" then select "AmazonS3FullAccess"

5. Click "Import"

6. Since access is only required for this bucket, change the JSON `"Resource": ` key from an asterick to the below by copying the Bucket ARN (see Bucket Permissions, above) and pasting it into the JSON

	```
	"Resource": [
                "arn:(etc)",
                "arn:(etc)/*"
                ]
	```
7. Click "Next" and add tags if desired

8. Click next to review and name the policy

	`name-of-you-app-policy`

9. Give the policy a description

	`Access to S3 bucket for name-of-your-app static files`

10. Click "Create policy"

### Attaching the Policy to the User Group

1. Select User Groups from the dashboard

2. Select the relevant group name

3. In the "Permissions" tab, click "Add permissions" and the choose "Attach policy" from the menu

4. Select the required policy then click "Add policy"

### Creating the User for the User Group

1. Select "Users" from the dashboard

2. Click "Add users" and add a user name, for example `name-of-you-app-staticfiles-user`

3. Select "Programmatic access" as the AWS access type

4. Click "Next: Permissions"

5. Select the relevant group to add the user to

6. Click "Next: Tags" then add tags if desired

7. Click "Next: Review"

8. Click "Create user"

9. Click "Download .csv" to download the attached csv file. 

	<span style="color:red">**It is very important to download and save this file as it cannot be re-downloaded at a later time!**</span>

## Configure Django to connect to S3

1. In the CLI of the app, install `boto-3` and `django-storages`

	```
	pip3 install boto3
	pip3 install django-storages
	```
2. Freeze the requirements

	`pip3 freeze > requirements.txt`

3. Add `storages` to the list of `INSTALLED_APPS` in app/settings.py

### Add settings to settings.py so that the live (deployed to heroku) site connects to S3.

Since the styling and images are available within the app (thanks to the use of the inbuilt sqlite database), they will always be visible while in development. Thus, it is ONLY the live deployed site that needs to connect to S3

1. Add relevant `if` statement: "if there is a vairable called USE_AWS in the environment, then connect to AWS"

	```
	if 'USE_AWS' in os.environ:
    	# Bucket config
    	AWS_STORAGE_BUCKET_NAME = 'name-of-your-app'
    	AWS_S3_REGION_NAME = '(the region choen when setting up AWS)'
    	AWS_ACCESS_KEY_ID = os.environ.get('AWS_ACCESS_KEY_ID')
    	AWS_SECRET_ACCESS_KEY = os.environ.get('AWS_SECRET_ACCESS_KEY')
	```

	<span style="color:red">**Again, it is very important you keep these last two keys' values secret as if they end up in version control someone could use them to store or move data through your S3 bucket and Amazon would bill your credit card for it**</span>

### Adding the AWS keys to heroku's Config Vars

1. In the heroku.com dashboard create two new variables and populate them with the relevant values from the downloaded .csv file

	`AWS_ACCESS_KEY_ID` = Access key ID value

	`AWS_SECRET_ACCESS_KEY` = Secret access key value

2. Add `USE_AWS` to the Config Vars in heroku and set its value to `True`

3. Remove the `DISABLE_COLLECTSTATIC` variable so that when deploying to Heroku, Django will collect static files automatically and upload them to S3

### Tell django where static files will come from in production

1. In app/settings.py, add another vairable to the `if 'USE_AWS' in os.environ:` statement

	`AWS_S3_CUSTOM_DOMAIN = f'{AWS_STORAGE_BUCKET_NAME}.s3.amazonaws.com'`

2. At system level, create a new file called `custom_storages.py`

3. In this file, import the following

	```
	from django.conf import settings
	from storages.backends.s3boto3 import S3Boto3Storage
	```

4. Create the following custom Classes:

	```
	class StaticStorage(S3Boto3Storage):
    	location = settings.STATICFILES_LOCATION

	class MediaStorage(S3Boto3Storage):
    	location = settings.MEDIAFILES_LOCATION
	```

5. Tell app/settings.py that for static file storage it use the above custom storage Classes and that the location it should save static files to is in a folder called static. Inside the same `if USE_AWS in os.environ:` statement, add

	```
	STATICFILES_STORAGE = 'custom_storages.StaticStorage'
    STATICFILES_LOCATION = 'static'
    DEFAULT_FILE_STORAGE = 'custom_storages.MediaStorage'
    MEDIAFILES_LOCATION = 'media'
	```

6. In the same `if` statement, override and explicitly set the URLs for static and media files using the custom domain and the new locations

	```
	STATIC_URL = f'https://{AWS_S3_CUSTOM_DOMAIN}/{STATICFILES_LOCATION}/'
    MEDIA_URL = f'https://{AWS_S3_CUSTOM_DOMAIN}/{MEDIAFILES_LOCATION}/'
	```

## Caching, Media Files & Admin

### Caching

If the media images and static files are unlikely to change often, they can be cached. Within the same `if` statement, add a cache control dictionary such as

```
if 'USE_AWS' in os.environ:
    # Cache control
    AWS_S3_OBJECT_PARAMETERS = {
        'Expires': 'Thu, 31 Dec 2099 20:00:00 GMT',
        'CacheControl': 'max-age=94608000',
    }

    # Bucket config (added above)
```

### Adding Media Files to S3

1. Back in the aws.amazon.com site, create a new file in the relevant bucket called `media`

2. Clik the file to open it, and then click "Upload", "Add files", and select all the images to be uploaded to AWS

3. Under "Permissions", choose "Grant public read access" and acknowledge the risk

4. Click "Upload"

5. The live site should now render correctly, with styling and images displaying

### Confirm admin status

1. Log in to the live site using the superuser log in details from above and then navigate to `name-of-your-app.herokuapp.com/admin`

2. In "Email addresses" confirm yourself as both Verified and Primary

3. Click "Save"

## Stripe

### Stripe keys

1. Go to your stripe.com account dashboard and navigate to "API keys"

2. Add the "publishable key" and "Secret key" as variables in the Config Vars of your heroku dashboard

	`STRIPE_PUBLIC_KEY` = Publishable key
	
	`STRIPE_SECRET_KEY` = Secret key

### Webhooks

1. Add new webhook endpoints by going to "Webhooks" in the Stripe dashboard and clicking "Add endpoint"

2. Copy the url of the home page of the live site and add this to the webhook Endpoint URL box

3. Add `checkout/wh/` to the end of the entered url

4. Reveal the webhook signing secret and add this to a further variable in Config Vars of the heroku dashboard

	`STRIPE_WH_SECRET` = Signing secret

5. Test by sending a test webhook and checking the logged Response

## Testing

The site should now be live and runnig  perfectly. Test it by creating an order, checking the Events and Webhooks tabs in Stripe, and then by navigating to the admin of the site.

## Emails

For users to create accounts and use the site, they will need to receive emails. 

### The email account

1. Either set up an email account or use an existing account for the site. The easiest way to do this is in gmail.com

2. Allow 2-step verification in gmail

3. Go to "app passwords" and set a site specific password for the django app

	`App`: set "email"
	
	`Device type`: set "django" (for example)

4. Copy the 16 digit password and add this to the heroku dashboard Config Vars

	`EMAIL_HOST_PASS` = the 16 digit passwird

5. Set the email address in Config Vars

	`EMAIL_HOST_USER` = the email account name (name@gmail.com...)

### The live site

1. Certain variables need to be set in app/settings.py. These are

	```
	if 'DEVELOPMENT' in os.environ:
    	EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'
    	DEFAULT_FROM_EMAIL = '<emailaddresschosen@email.com>'
	else:
    	EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
    	EMAIL_USE_TLS = True
    	EMAIL_PORT = 587
    	EMAIL_HOST = 'smtp.gmail.com'
    	EMAIL_HOST_USER = os.environ.get('EMAIL_HOST_USER')
    	EMAIL_HOST_PASSWORD = os.environ.get('EMAIL_HOST_PASS')
    	DEFAULT_FROM_EMAIL = os.environ.get('EMAIL_HOST_USER')
	```

2. Navigate to the live site's admin and go to "Sites"

3. Set the "Domain name" and "Display name" as approrpiate

4. Commit all changes

	```
	git add .
	git commit -m ‘Email set up’
	git push
	```

5. Test by creating a new account and verifiying email reception. Click the verification link in the email to verify the account and then log in

## Clone this GitHub Repository 

This repository can be cloned by following these steps:

1. Log in to GitHub and locate the repository.

2. Click the "Code" button:


Either click "Open with GitHub Desktop" and follow the prompts in the GitHub Desktop application, or alternatively follow the instructions from this link, depending on your Operating System.

3. Install the dependencies using these commands:

	```
	# Project dependencies
	pip3 install django
	pip3 install django-allauth==0.41.0
	pip3 install pillow
	pip3 install django-crispy-forms
	pip3 install django-countries
	pip3 install stripe
    pip3 install django-ckeditor
	
	# Deployment
	pip3 install boto3
	pip3 install django-storages
	pip3 install gunicorn
	pip3 install dj_database_url
	pip3 install psycopg2-binary

	# Freeze dependencies to keep them available when publishing
	pip3 freeze > requirements.txt
	```

 








































